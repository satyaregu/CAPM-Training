'use strict';
const {VError} = require('verror');

exports.getValidatedEnvInt = function(envVarName, defaultValue = 0) {
  const value = process.env[envVarName];
  if (value === undefined) {
    return defaultValue;
  }
  // Check if value is a string representing a non-negative integer
  if (!/^\d+$/.test(value)) {
    throw VError(`Environment variable ${envVarName} must be a non-negative integer. Current value: ${value}`);
  }
  const intValue = parseInt(value, 10);
  if (!isNaN(intValue) && Number.isInteger(intValue) && intValue >= 0) {
    return intValue;
  }
  throw VError(`Environment variable ${envVarName} must be a non-negative integer. Current value: ${value}`);
};
